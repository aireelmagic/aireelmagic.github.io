async function loadPageData(){try{const t=await fetch("./data.json");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){return console.error("Failed to load page data:",t),document.getElementById("content-container").innerHTML=`\n                <div class="section">\n                    <h2 class="section-title">加载错误</h2>\n                    <div class="section-content">\n                        <p>无法加载页面数据。请检查 data.json 文件是否存在且格式正确。</p>\n                        <p>错误信息: ${t.message}</p>\n                    </div>\n                </div>\n            `,null}}function detectUserLanguage(){const t=localStorage.getItem("procut-language-preference");if(t&&pageData.language[t])return t;const e=navigator.language||navigator.userLanguage;return e.startsWith("zh")&&pageData.language.zh?"zh":(e.startsWith("en")&&pageData.language.en,"en")}function renderPage(t){const e=pageData.language[t];document.querySelector(".logo-text h1").textContent=e.logo.title,document.querySelector(".logo-text p").textContent=e.logo.subtitle,document.getElementById("download-btn").innerHTML=`<i class="fas fa-download"></i> ${e.download}`,document.querySelectorAll(".lang-link").forEach(e=>{e.getAttribute("data-lang")===t?e.classList.add("active"):e.classList.remove("active")}),renderNavigation(e),renderContent(e),initVideoObservers()}function renderNavigation(t){const e=document.getElementById("nav-container");let a="";t.sections.forEach(t=>{a+=`\n                <div class="nav-item" data-target="${t.id}">\n                    <i class="${t.icon}"></i>\n                    <span>${t.title}</span>\n                </div>\n            `}),e.innerHTML=a}function renderContent(t){const e=document.getElementById("content-container");let a="";t.sections.forEach(t=>{a+=`\n                <div class="section" id="${t.id}">\n                    <h2 class="section-title">${t.title}</h2>\n                    <div class="section-content">\n                        ${renderSectionContent(t.content,t.id)}\n                    </div>\n                </div>\n            `}),e.innerHTML=a}function renderSectionContent(t,e){let a="",n=0;return t.forEach(t=>{switch(t.type){case"text":a+=`<p>${t.value}</p>`;break;case"image":let s="";t.scale&&(s=`style="transform: scale(${t.scale});"`),a+=`\n                        <div class="image-container">\n                            <img src="${t.url}" alt="${t.caption}" ${s}>\n                            <div class="image-caption">${t.caption}</div>\n                        </div>\n                    `;break;case"gallery-tutorial":a+=renderGalleryTutorial(t,e,n++);break;case"grid":a+='<div class="feature-grid">',t.items.forEach(t=>{const e=t.ai?'<span class="ai-badge">AI</span>':"";a+=`\n                            <div class="feature-card">\n                                <h3><i class="${t.icon}"></i> ${t.title}${e}</h3>\n                                <p>${t.text}</p>\n                            </div>\n                        `}),a+="</div>";break;case"steps":a+='<ol class="step-list">',t.items.forEach(t=>{a+=`<li>${t}</li>`}),a+="</ol>";break;case"function-title":a+=`<h3 class="function-title">${t.value}</h3>`;break;case"video-comparison":a+=`\n                        <div class="video-comparison-container">\n                            <div class="video-comparison-header">\n                                <div class="video-title before">${t.before.title}</div>\n                                <div class="video-title after">${t.after.title}</div>\n                            </div>\n                            <div class="video-comparison-content">\n                                <div class="video-wrapper">\n                                    <video muted loop playsinline data-src="${t.before.src}">\n                                        您的浏览器不支持视频播放\n                                    </video>\n                                    <div class="video-indicator">${t.before.title}</div>\n                                    <div class="audio-status muted" data-video="before">\n                                        <i class="fas fa-volume-mute"></i>\n                                    </div>\n                                    <div class="audio-controls">\n                                        <button class="audio-btn muted" data-video="before" data-action="toggle-mute">\n                                            <i class="fas fa-volume-mute"></i>\n                                        </button>\n                                    </div>\n                                    <div class="video-controls">\n                                        <button class="control-btn play-pause-btn" data-video="before">\n                                            <i class="fas fa-play"></i>\n                                        </button>\n                                    </div>\n                                </div>\n                                <div class="video-wrapper">\n                                    <video muted loop playsinline data-src="${t.after.src}">\n                                        您的浏览器不支持视频播放\n                                    </video>\n                                    <div class="video-indicator">${t.after.title}</div>\n                                    <div class="audio-status muted" data-video="after">\n                                        <i class="fas fa-volume-mute"></i>\n                                    </div>\n                                    <div class="audio-controls">\n                                        <button class="audio-btn muted" data-video="after" data-action="toggle-mute">\n                                            <i class="fas fa-volume-mute"></i>\n                                        </button>\n                                    </div>\n                                    <div class="video-controls">\n                                        <button class="control-btn play-pause-btn" data-video="after">\n                                            <i class="fas fa-play"></i>\n                                        </button>\n                                    </div>\n                                </div>\n                            </div>\n\x3c!--                                <div class="sync-controls">--\x3e\n\x3c!--                                    <button class="control-btn primary" data-action="sync-play">--\x3e\n\x3c!--                                        <i class="fas fa-play-circle"></i> 同步播放--\x3e\n\x3c!--                                    </button>--\x3e\n\x3c!--                                    <button class="control-btn primary" data-action="sync-pause">--\x3e\n\x3c!--                                        <i class="fas fa-pause-circle"></i> 同步暂停--\x3e\n\x3c!--                                    </button>--\x3e\n\x3c!--                                    <button class="control-btn" data-action="sync-reset">--\x3e\n\x3c!--                                        <i class="fas fa-redo"></i> 重置--\x3e\n\x3c!--                                    </button>--\x3e\n\x3c!--                                </div>--\x3e\n                        </div>\n                    `}}),a}function renderGalleryTutorial(t,e,a){const n=`gallery-${e}-${t.id||a}`;let s="",o="";return t.items.forEach((e,a)=>{const i=0===a?"active":"",c=a+1;s+=`\n                <div class="carousel-item ${i}">\n                    <div class="tutorial-content">\n                        <div class="tutorial-image">\n\n                            <img src="${e.image}" alt="${e.title}">\n                        </div>\n                        <div class="tutorial-text">\n                            <h3 class="tutorial-title" data-step="${c}">${e.title}</h3>\n                            <p class="tutorial-description">${e.description}</p>\n                            <div class="step-counter">\n                                <span class="current-step">${c}</span>\n                                <span class="step-divider">/</span>\n                                <span class="total-steps">${t.items.length}</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `,o+=`\n                <button type="button" data-bs-target="#${n}" data-bs-slide-to="${a}"\n                        class="${i}" aria-label="步骤 ${c}">\n                    <span class="step-number">${c}</span>\n                </button>\n            `}),`\n            <div class="tutorial-section">\n                <h3 class="tutorial-section-title">${t.title}</h3>\n                <div id="${n}" class="carousel slide" data-bs-interval="false">\n                    <div class="carousel-indicators">\n                        ${o}\n                    </div>\n                    <div class="carousel-inner">\n                        ${s}\n                    </div>\n                    <button class="carousel-control-prev" type="button" data-bs-target="#${n}" data-bs-slide="prev">\n                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>\n                        <span class="visually-hidden">上一步</span>\n                    </button>\n                    <button class="carousel-control-next" type="button" data-bs-target="#${n}" data-bs-slide="next">\n                        <span class="carousel-control-next-icon" aria-hidden="true"></span>\n                        <span class="visually-hidden">下一步</span>\n                    </button>\n                </div>\n            </div>\n        `}function initVideoObservers(){document.querySelectorAll(".video-comparison-container").forEach(t=>{new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting?playVideosInContainer(t):pauseVideosInContainer(t)})},{threshold:.5}).observe(t)}),initVideoControls()}function playVideosInContainer(t){t.querySelectorAll("video").forEach(t=>{!t.src&&t.dataset.src&&(t.src=t.dataset.src),t.play().catch(t=>{console.log("视频自动播放被阻止:",t)})}),updatePlayPauseButtons(t,!0)}function pauseVideosInContainer(t){t.querySelectorAll("video").forEach(t=>{t.pause()}),updatePlayPauseButtons(t,!1)}function updatePlayPauseButtons(t,e){t.querySelectorAll(".play-pause-btn").forEach(t=>{t.innerHTML=e?'<i class="fas fa-pause"></i> ':'<i class="fas fa-play"></i> '})}function initVideoControls(){document.addEventListener("click",function(t){if(t.target.closest(".play-pause-btn")){const e=t.target.closest(".play-pause-btn").closest(".video-comparison-container");e.querySelectorAll("video")[0].paused?syncPlayVideos(e):syncPauseVideos(e)}if(t.target.closest(".control-btn")){const e=t.target.closest(".control-btn"),a=e.dataset.action,n=e.closest(".video-comparison-container");"sync-play"===a?syncPlayVideos(n):"sync-pause"===a?syncPauseVideos(n):"sync-reset"===a&&syncResetVideos(n)}if(t.target.closest(".audio-btn")){const e=t.target.closest(".audio-btn"),a=e.dataset.video,n=e.closest(".video-comparison-container"),s=n.querySelector(`.video-wrapper:${"before"===a?"first-child":"last-child"} video`),o=n.querySelector(`.audio-status[data-video="${a}"]`);s.muted=!s.muted,s.muted?(e.classList.add("muted"),e.innerHTML='<i class="fas fa-volume-mute"></i> ',o.classList.add("muted"),o.innerHTML='<i class="fas fa-volume-mute"></i> '):(e.classList.remove("muted"),e.innerHTML='<i class="fas fa-volume-up"></i> ',o.classList.remove("muted"),o.innerHTML='<i class="fas fa-volume-up"></i> ')}}),setupVideoSync()}function setupVideoSync(){document.querySelectorAll(".video-comparison-container").forEach(t=>{const e=t.querySelectorAll("video");e.forEach(a=>{a.addEventListener("timeupdate",function(){e.forEach(t=>{t!==a&&Math.abs(t.currentTime-a.currentTime)>.1&&(t.currentTime=a.currentTime)})}),a.addEventListener("play",function(){updatePlayPauseButtons(t,!0)}),a.addEventListener("pause",function(){updatePlayPauseButtons(t,!1)})})})}function syncPlayVideos(t){const e=t.querySelectorAll("video"),a=[];e.forEach(t=>{!t.src&&t.dataset.src&&(t.src=t.dataset.src),a.push(t.play())}),Promise.all(a).then(()=>{updatePlayPauseButtons(t,!0)}).catch(t=>{console.log("部分视频播放失败:",t)})}function syncPauseVideos(t){t.querySelectorAll("video").forEach(t=>{t.pause()}),updatePlayPauseButtons(t,!1)}function syncResetVideos(t){t.querySelectorAll("video").forEach(t=>{t.pause(),t.currentTime=0}),updatePlayPauseButtons(t,!1)}function setupEventListeners(t){let e=!1;const a=document.getElementById("content-container");document.addEventListener("click",function(t){if(t.target.closest(".nav-item")){const n=t.target.closest(".nav-item"),s=n.getAttribute("data-target");e=!0,document.querySelectorAll(".nav-item").forEach(t=>{t.classList.remove("active")}),n.classList.add("active");const o=document.getElementById(s);if(o){const t=o.offsetTop-20;a.scrollTo({top:t,behavior:"smooth"}),setTimeout(()=>{document.querySelectorAll(".nav-item").forEach(t=>{t.classList.remove("active")}),n.classList.add("active"),e=!1},500)}}if(t.target.classList.contains("lang-link")){t.preventDefault();const e=t.target.getAttribute("data-lang");localStorage.setItem("procut-language-preference",e),renderPage(e),setupEventListeners(e)}});const n=document.querySelectorAll(".nav-item");a.addEventListener("scroll",function(){if(e)return;const s=a.scrollTop+150;let o="";const i=pageData.language[t].sections;let c=1/0;i.forEach(t=>{const e=document.getElementById(t.id);if(e){const a=e.offsetTop,n=a+e.offsetHeight;if(s>=a&&s<=n){const e=Math.abs(a-s);e<c&&(c=e,o=t.id)}}}),o||i.forEach(t=>{const e=document.getElementById(t.id);if(e){const a=Math.abs(e.offsetTop-s);a<c&&(c=a,o=t.id)}}),n.forEach(t=>{t.classList.remove("active"),t.getAttribute("data-target")===o&&t.classList.add("active")})}),document.getElementById("download-btn").addEventListener("click",function(t){t.preventDefault(),alert("开始下载ProCut安装程序...")}),initEmailSubscription()}pageData={},document.addEventListener("DOMContentLoaded",async function(){if(pageData=await loadPageData(),!pageData)return;let t=detectUserLanguage();renderPage(t,pageData),setupEventListeners(t,pageData),document.querySelector(".nav-item").classList.add("active")});