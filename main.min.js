async function loadPageData(){try{const e=await fetch("./data.json");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(e){return console.error("Failed to load page data:",e),document.getElementById("content-container").innerHTML=`\n                <div class="section">\n                    <h2 class="section-title">加载错误</h2>\n                    <div class="section-content">\n                        <p>无法加载页面数据。请检查 data.json 文件是否存在且格式正确。</p>\n                        <p>错误信息: ${e.message}</p>\n                    </div>\n                </div>\n            `,null}}function detectUserLanguage(){const e=localStorage.getItem("procut-language-preference");if(e&&pageData.language[e])return e;const t=navigator.language||navigator.userLanguage;return t.startsWith("zh")&&pageData.language.zh?"zh":(t.startsWith("en")&&pageData.language.en,"en")}function renderPage(e){const t=pageData.language[e];document.querySelector(".logo-text h1").textContent=t.logo.title,document.querySelector(".logo-text p").textContent=t.logo.subtitle,document.getElementById("download-btn").innerHTML=`<i class="fas fa-download"></i> ${t.download}`,document.querySelectorAll(".lang-link").forEach(t=>{t.getAttribute("data-lang")===e?t.classList.add("active"):t.classList.remove("active")}),renderNavigation(t),renderContent(t),initVideoObservers()}function renderNavigation(e){const t=document.getElementById("nav-container");let a="";e.sections.forEach(e=>{a+=`\n                <div class="nav-item" data-target="${e.id}">\n                    <i class="${e.icon}"></i>\n                    <span>${e.title}</span>\n                </div>\n            `}),t.innerHTML=a}function renderContent(e){const t=document.getElementById("content-container");let a="";e.sections.forEach(e=>{a+=`\n                <div class="section" id="${e.id}">\n                    <h2 class="section-title">${e.title}</h2>\n                    <div class="section-content">\n                        ${renderSectionContent(e.content,e.id)}\n                    </div>\n                </div>\n            `}),t.innerHTML=a}function renderSectionContent(e,t){let a="",n=0;return e.forEach(e=>{switch(e.type){case"text":a+=`<p>${e.value}</p>`;break;case"image":let s="";e.scale&&(s=`style="transform: scale(${e.scale});"`),a+=`\n                        <div class="image-container">\n                            <img src="${e.url}" alt="${e.caption}" ${s}>\n                            <div class="image-caption">${e.caption}</div>\n                        </div>\n                    `;break;case"gallery-tutorial":a+=renderGalleryTutorial(e,t,n++);break;case"grid":a+='<div class="feature-grid">',e.items.forEach(e=>{const t=e.ai?'<span class="ai-badge">AI</span>':"";a+=`\n                            <div class="feature-card">\n                                <h3><i class="${e.icon}"></i> ${e.title}${t}</h3>\n                                <p>${e.text}</p>\n                            </div>\n                        `}),a+="</div>";break;case"steps":a+='<ol class="step-list">',e.items.forEach(e=>{a+=`<li>${e}</li>`}),a+="</ol>";break;case"function-title":a+=`<h3 class="function-title">${e.value}</h3>`;break;case"video-comparison":a+=`\n                        <div class="video-comparison-container">\n                            <div class="video-comparison-header">\n                                <div class="video-title before">${e.before.title}</div>\n                                <div class="video-title after">${e.after.title}</div>\n                            </div>\n                            <div class="video-comparison-content">\n                                <div class="video-wrapper">\n                                    <video muted loop playsinline data-src="${e.before.src}">\n                                        您的浏览器不支持视频播放\n                                    </video>\n                                    <div class="video-indicator">${e.before.title}</div>\n                                    <div class="audio-status muted" data-video="before">\n                                        <i class="fas fa-volume-mute"></i>\n                                    </div>\n                                    <div class="audio-controls">\n                                        <button class="audio-btn muted" data-video="before" data-action="toggle-mute">\n                                            <i class="fas fa-volume-mute"></i>\n                                        </button>\n                                    </div>\n                                    <div class="video-controls">\n                                        <button class="control-btn play-pause-btn" data-video="before">\n                                            <i class="fas fa-play"></i>\n                                        </button>\n                                    </div>\n                                </div>\n                                <div class="video-wrapper">\n                                    <video muted loop playsinline data-src="${e.after.src}">\n                                        您的浏览器不支持视频播放\n                                    </video>\n                                    <div class="video-indicator">${e.after.title}</div>\n                                    <div class="audio-status muted" data-video="after">\n                                        <i class="fas fa-volume-mute"></i>\n                                    </div>\n                                    <div class="audio-controls">\n                                        <button class="audio-btn muted" data-video="after" data-action="toggle-mute">\n                                            <i class="fas fa-volume-mute"></i>\n                                        </button>\n                                    </div>\n                                    <div class="video-controls">\n                                        <button class="control-btn play-pause-btn" data-video="after">\n                                            <i class="fas fa-play"></i>\n                                        </button>\n                                    </div>\n                                </div>\n                            </div>\n\x3c!--                                <div class="sync-controls">--\x3e\n\x3c!--                                    <button class="control-btn primary" data-action="sync-play">--\x3e\n\x3c!--                                        <i class="fas fa-play-circle"></i> 同步播放--\x3e\n\x3c!--                                    </button>--\x3e\n\x3c!--                                    <button class="control-btn primary" data-action="sync-pause">--\x3e\n\x3c!--                                        <i class="fas fa-pause-circle"></i> 同步暂停--\x3e\n\x3c!--                                    </button>--\x3e\n\x3c!--                                    <button class="control-btn" data-action="sync-reset">--\x3e\n\x3c!--                                        <i class="fas fa-redo"></i> 重置--\x3e\n\x3c!--                                    </button>--\x3e\n\x3c!--                                </div>--\x3e\n                        </div>\n                    `}}),a}function renderGalleryTutorial(e,t,a){const n=`gallery-${t}-${e.id||a}`;let s="",o="";return e.items.forEach((t,a)=>{const i=0===a?"active":"",c=a+1;s+=`\n                <div class="carousel-item ${i}">\n                    <div class="tutorial-content">\n                        <div class="tutorial-image">\n\n                            <img src="${t.image}" alt="${t.title}">\n                        </div>\n                        <div class="tutorial-text">\n                            <h3 class="tutorial-title" data-step="${c}">${t.title}</h3>\n                            <p class="tutorial-description">${t.description}</p>\n                            <div class="step-counter">\n                                <span class="current-step">${c}</span>\n                                <span class="step-divider">/</span>\n                                <span class="total-steps">${e.items.length}</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `,o+=`\n                <button type="button" data-bs-target="#${n}" data-bs-slide-to="${a}"\n                        class="${i}" aria-label="步骤 ${c}">\n                    <span class="step-number">${c}</span>\n                </button>\n            `}),`\n            <div class="tutorial-section">\n                <h3 class="tutorial-section-title">${e.title}</h3>\n                <div id="${n}" class="carousel slide" data-bs-interval="false">\n                    <div class="carousel-indicators">\n                        ${o}\n                    </div>\n                    <div class="carousel-inner">\n                        ${s}\n                    </div>\n                    <button class="carousel-control-prev" type="button" data-bs-target="#${n}" data-bs-slide="prev">\n                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>\n                        <span class="visually-hidden">上一步</span>\n                    </button>\n                    <button class="carousel-control-next" type="button" data-bs-target="#${n}" data-bs-slide="next">\n                        <span class="carousel-control-next-icon" aria-hidden="true"></span>\n                        <span class="visually-hidden">下一步</span>\n                    </button>\n                </div>\n            </div>\n        `}function initVideoObservers(){document.querySelectorAll(".video-comparison-container").forEach(e=>{new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting?playVideosInContainer(e):pauseVideosInContainer(e)})},{threshold:.5}).observe(e)}),initVideoControls()}function playVideosInContainer(e){e.querySelectorAll("video").forEach(e=>{!e.src&&e.dataset.src&&(e.src=e.dataset.src),e.play().catch(e=>{console.log("视频自动播放被阻止:",e)})}),updatePlayPauseButtons(e,!0)}function pauseVideosInContainer(e){e.querySelectorAll("video").forEach(e=>{e.pause()}),updatePlayPauseButtons(e,!1)}function updatePlayPauseButtons(e,t){e.querySelectorAll(".play-pause-btn").forEach(e=>{e.innerHTML=t?'<i class="fas fa-pause"></i> ':'<i class="fas fa-play"></i> '})}function initVideoControls(){setTimeout(()=>{document.addEventListener("click",function(e){if(e.target.closest(".play-pause-btn")){const t=e.target.closest(".play-pause-btn").closest(".video-comparison-container");t.querySelectorAll("video")[0].paused?syncPlayVideos(t):syncPauseVideos(t)}if(e.target.closest(".control-btn")){const t=e.target.closest(".control-btn"),a=t.dataset.action,n=t.closest(".video-comparison-container");"sync-play"===a?syncPlayVideos(n):"sync-pause"===a?syncPauseVideos(n):"sync-reset"===a&&syncResetVideos(n)}if(e.target.closest(".audio-btn")){const t=e.target.closest(".audio-btn"),a=t.dataset.video,n=t.closest(".video-comparison-container"),s=n.querySelector(`.video-wrapper:${"before"===a?"first-child":"last-child"}`).querySelector("video"),o=n.querySelector(`.audio-status[data-video="${a}"]`);!s.src&&s.dataset.src?(s.src=s.dataset.src,s.addEventListener("loadeddata",function(){toggleVideoMute(s,t,o)},{once:!0})):toggleVideoMute(s,t,o)}}),setupVideoSync(),initializeVideoMuteStates()},500)}function toggleVideoMute(e,t,a){e.muted=!e.muted,e.muted?(t.classList.add("muted"),t.innerHTML='<i class="fas fa-volume-mute"></i> 取消静音',a.classList.add("muted"),a.innerHTML='<i class="fas fa-volume-mute"></i> 静音'):(t.classList.remove("muted"),t.innerHTML='<i class="fas fa-volume-up"></i> 静音',a.classList.remove("muted"),a.innerHTML='<i class="fas fa-volume-up"></i> 有声')}function initializeVideoMuteStates(){document.querySelectorAll(".video-comparison-container").forEach(e=>{const t=e.querySelectorAll("video"),a=e.querySelectorAll(".audio-btn"),n=e.querySelectorAll(".audio-status");t.forEach((e,t)=>{!e.src&&e.dataset.src&&(e.src=e.dataset.src),e.muted=!0,a[t]&&(a[t].classList.add("muted"),a[t].innerHTML='<i class="fas fa-volume-mute"></i> 取消静音'),n[t]&&(n[t].classList.add("muted"),n[t].innerHTML='<i class="fas fa-volume-mute"></i> 静音')})})}function setupVideoSync(){document.querySelectorAll(".video-comparison-container").forEach(e=>{const t=e.querySelectorAll("video");t.forEach(a=>{a.addEventListener("timeupdate",function(){t.forEach(e=>{e!==a&&Math.abs(e.currentTime-a.currentTime)>.1&&(e.currentTime=a.currentTime)})}),a.addEventListener("play",function(){updatePlayPauseButtons(e,!0)}),a.addEventListener("pause",function(){updatePlayPauseButtons(e,!1)}),a.addEventListener("loadeddata",function(){this.muted=!0;const e=this.closest(".video-wrapper"),t=e.querySelector(".audio-btn"),a=e.querySelector(".audio-status");t&&a&&(t.classList.add("muted"),t.innerHTML='<i class="fas fa-volume-mute"></i> 取消静音',a.classList.add("muted"),a.innerHTML='<i class="fas fa-volume-mute"></i> 静音')})})})}function syncPlayVideos(e){const t=e.querySelectorAll("video"),a=[];t.forEach(e=>{if(!e.src&&e.dataset.src)e.src=e.dataset.src,e.addEventListener("loadeddata",function(){const t=e.muted;a.push(e.play().then(()=>{e.muted=t}))},{once:!0});else{const t=e.muted;a.push(e.play().then(()=>{e.muted=t}))}}),Promise.all(a).then(()=>{updatePlayPauseButtons(e,!0)}).catch(e=>{console.log("部分视频播放失败:",e)})}function syncPauseVideos(e){e.querySelectorAll("video").forEach(e=>{e.pause()}),updatePlayPauseButtons(e,!1)}function syncResetVideos(e){e.querySelectorAll("video").forEach(e=>{e.pause(),e.currentTime=0}),updatePlayPauseButtons(e,!1)}function setupEventListeners(e){let t=!1;const a=document.getElementById("content-container");document.addEventListener("click",function(e){if(e.target.closest(".nav-item")){const n=e.target.closest(".nav-item"),s=n.getAttribute("data-target");t=!0,document.querySelectorAll(".nav-item").forEach(e=>{e.classList.remove("active")}),n.classList.add("active");const o=document.getElementById(s);if(o){const e=o.offsetTop-20;a.scrollTo({top:e,behavior:"smooth"}),setTimeout(()=>{document.querySelectorAll(".nav-item").forEach(e=>{e.classList.remove("active")}),n.classList.add("active"),t=!1},500)}}if(e.target.classList.contains("lang-link")){e.preventDefault();const t=e.target.getAttribute("data-lang");localStorage.setItem("procut-language-preference",t),renderPage(t),setupEventListeners(t)}});const n=document.querySelectorAll(".nav-item");a.addEventListener("scroll",function(){if(t)return;const s=a.scrollTop+150;let o="";const i=pageData.language[e].sections;let c=1/0;i.forEach(e=>{const t=document.getElementById(e.id);if(t){const a=t.offsetTop,n=a+t.offsetHeight;if(s>=a&&s<=n){const t=Math.abs(a-s);t<c&&(c=t,o=e.id)}}}),o||i.forEach(e=>{const t=document.getElementById(e.id);if(t){const a=Math.abs(t.offsetTop-s);a<c&&(c=a,o=e.id)}}),n.forEach(e=>{e.classList.remove("active"),e.getAttribute("data-target")===o&&e.classList.add("active")})}),document.getElementById("download-btn").addEventListener("click",function(e){e.preventDefault(),alert("开始下载ProCut安装程序...")}),initEmailSubscription()}pageData={},document.addEventListener("DOMContentLoaded",async function(){if(pageData=await loadPageData(),!pageData)return;let e=detectUserLanguage();renderPage(e,pageData),setupEventListeners(e,pageData),document.querySelector(".nav-item").classList.add("active")});